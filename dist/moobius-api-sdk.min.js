!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).moobiusSdk=t()}(this,(function(){"use strict";function e(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{a(o.next(e))}catch(e){i(e)}}function c(e){try{a(o.throw(e))}catch(e){i(e)}}function a(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,c)}a((o=o.apply(e,t||[])).next())}))}function t(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(a){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return s.label++,{value:c[1],done:!1};case 5:s.label++,o=c[1],c=[0];continue;case 7:c=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){s=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){s.label=c[1];break}if(6===c[0]&&s.label<r[1]){s.label=r[1],r=c;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(c);break}r[2]&&s.ops.pop(),s.trys.pop();continue}c=t.call(e,s)}catch(e){c=[6,e],o=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,a])}}}function n(e,t){return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return e.apply(t,n)}}"function"==typeof SuppressedError&&SuppressedError;var o,r=Array.isArray,i=(o="function",function(e){return typeof e===o});function s(e){return e&&"object"==typeof e&&!Array.isArray(e)}function c(e){for(var t,n,o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];if(!o.length)return e;var i=o.shift();if(s(e)&&s(i))for(var a in i)i.hasOwnProperty(a)&&(s(i[a])?(e[a]||Object.assign(e,((t={})[a]={},t)),c(e[a],i[a])):Object.assign(e,((n={})[a]=i[a],n)));return c.apply(void 0,function(e,t,n){if(n||2===arguments.length)for(var o,r=0,i=t.length;r<i;r++)!o&&r in t||(o||(o=Array.prototype.slice.call(t,0,r)),o[r]=t[r]);return e.concat(o||Array.prototype.slice.call(t))}([e],o,!1))}var a,u,l=function(e,t,o,s){return function(e,t,n){var o,i,s=(void 0===n?{}:n).allOwnKeys,c=void 0!==s&&s;if(null!=e)if("object"!=typeof e&&(e=[e]),r(e))for(o=0,i=e.length;o<i;o++)t.call(null,e[o],o,e);else{var a=c?Object.getOwnPropertyNames(e):Object.keys(e),u=a.length,l=void 0;for(o=0;o<u;o++)l=a[o],t.call(null,e[l],l,e)}}(t,(function(t,r){o&&i(t)?e[r]=n(t,o):e[r]=t}),{allOwnKeys:(void 0===s?{allOwnKeys:!1}:s).allOwnKeys}),e},f=(a=Object.create(null),function(e){var t=toString.call(e);return a[t]||(a[t]=t.slice(8,-1).toLowerCase())}),p=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")},h="undefined"!=typeof process&&"process"===f(process)&&function(){this.type="node",console.log("node",this,p)},d=new Uint8Array(16);function y(){if(!u&&!(u="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return u(d)}for(var v=[],b=0;b<256;++b)v.push((b+256).toString(16).slice(1));var g={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function k(e,t,n){if(g.randomUUID&&!t&&!e)return g.randomUUID();var o=(e=e||{}).random||(e.rng||y)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t){n=n||0;for(var r=0;r<16;++r)t[n+r]=o[r];return t}return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return v[e[t+0]]+v[e[t+1]]+v[e[t+2]]+v[e[t+3]]+"-"+v[e[t+4]]+v[e[t+5]]+"-"+v[e[t+6]]+v[e[t+7]]+"-"+v[e[t+8]]+v[e[t+9]]+"-"+v[e[t+10]]+v[e[t+11]]+v[e[t+12]]+v[e[t+13]]+v[e[t+14]]+v[e[t+15]]}(o)}var m,w="undefined"!=typeof WebSocket&&(m=function(){function n(n,o){var r,i,s=this;this.type="client",this.socket=null,this.reconnectMaxCount=3,this.heartbeatTime=6e3,this.requestCallbacks={},this.heartbeatTimer=null,this.connect=function(){s.close(),s.socket=new WebSocket(s.url),s.onError(),s.onOpen(),s.onMessage()},this.login=function(){return e(s,void 0,void 0,(function(){return t(this,(function(e){return[2]}))}))},this.onMessage=function(){s.socket.onmessage=function(n){return e(s,void 0,void 0,(function(){var e,o,r,i,s,c,a;return t(this,(function(t){try{if(e=JSON.parse(null==n?void 0:n.data),o=e.type,r=e.body,i=r.request_id,s=r.status,c=r.origin_type,a=r.context,"copy"===o)return i&&this.requestCallbacks[i]&&(s||(console.error("".concat(c," : ").concat(a.message)),(a.message.includes("access_token")||a.message.includes("login yet"))&&console.log("refresh token")),"user_login"===c&&this.processMessageQueue(),this.requestCallbacks[i](e),delete this.requestCallbacks[i]),[2];this.socketCustomMessageEventList[o]&&this.socketCustomMessageEventList[o](e)}catch(e){console.error(e)}return[2]}))}))}},this.processMessageQueue=function(){},this.ignoreLoginMessage=function(e){return"user_login"===e.type||"ping"===e.type},this.reconnect=function(){return new Promise((function(e,t){s.connect(),e({})}))};var a=c(o,{autoReconnect:{reconnectMaxCount:3},heartbeat:{interval:1e4},query:{}});this.url=this.formatUrl(n,a.query),this.reconnectMaxCount=(null===(r=a.autoReconnect)||void 0===r?void 0:r.reconnectMaxCount)||3,this.heartbeatTime=(null===(i=a.heartbeat)||void 0===i?void 0:i.interval)||3e3,this.socketCustomMessageEventList=(null==a?void 0:a.onMessageEvent)||{},this.connect()}return n.prototype.onOpen=function(){var e=this;this.socket&&(this.socket.onopen=function(){e.login(),e.heartbeatTime&&e.startHeartbeat()})},n.prototype.startHeartbeat=function(){var e=this,t=this.heartbeatTime;this.heartbeatTimer=setInterval((function(){e.send({type:"heartbeat",request_id:k(),body:{}})}),t)},n.prototype.send=function(e,t){var n=this;return void 0===t&&(t=function(){}),new Promise((function(o,r){if(n.socket){var i=function(){if(n.socket)if(n.socket.readyState===n.socket.OPEN)try{n.requestCallbacks[e.request_id||k()]=function(e){t(e),o(e)},n.socket.send(JSON.stringify(e)),o()}catch(e){r(e)}else[n.socket.CLOSING,n.socket.CLOSED].includes(n.socket.readyState)?n.reconnect().then((function(){setTimeout(i,1e3)})).catch(r):n.socket.readyState===n.socket.CONNECTING&&setTimeout(i,1e3);else r(new Error("socket is null"))};i()}else r(new Error("socket is null"))}))},n.prototype.close=function(){var e;null===(e=this.socket)||void 0===e||e.close(),clearInterval(this.heartbeatTimer),this.socket=null},n.prototype.onError=function(){this.socket&&(this.socket.onerror=function(e){console.log("socket:error:event:",e)})},n.prototype.formatUrl=function(e,t){var n=e.includes("?");return e+=Object.keys(t).length?"".concat(n?"&":"?").concat(Object.keys(t).map((function(e){return"".concat(e,"=").concat(t[e])})).join("&")):""},n}(),m.isLoggedIn=!1,m.unloginMessageQueue=[],m),O={webSocket:w,nodeSocket:h},S=function(e){return i(e)||null===e||!1===e},C=function(e){return"- ".concat(e)},E=function(e){for(var t,n,o=r(e)?e:[e],i=e.length,s={},c=0;c<i;c++){var a=void 0;if(n=t=o[c],S(t)||void 0===(n=O[a=String(t)])&&console.error("Unknown adapter '".concat(a,"'")),n)break;s[a||"#"+c]=n}if(!n){var u=Object.entries(s).map((function(e){var t=e[0],n=e[1];return"adapter ".concat(t," ")+(!1===n?"is not supported by the environment":"is not available in the build")})),l=i?u.length>1?"since :\n"+u.map(C).join("\n"):" "+C(u[0]):"as no adapter specified";console.error("There is no suitable adapter to dispatch the request "+l,"ERR_NOT_SUPPORT")}return n},T=function(){function e(e){this.defaults=e,this.config=e}return e.prototype.init=function(e){this.config=c(this.defaults,e);var t=new(E(e.adapter||this.defaults.adapter));console.log(t.type)},e}();var j,U;return j=new T({adapter:["webSocket","nodeSocket"],url:"https://api.moobius.net"}),U=n(T.prototype.init,j),l(U,T.prototype,j,{allOwnKeys:!0}),l(U,j,null,{allOwnKeys:!0}),U}));
//# sourceMappingURL=moobius-api-sdk.min.js.map
