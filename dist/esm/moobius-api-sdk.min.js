function t(t,e,n,o){return new(n||(n=Promise))((function(r,i){function s(t){try{a(o.next(t))}catch(t){i(t)}}function c(t){try{a(o.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}a((o=o.apply(t,e||[])).next())}))}function e(t,e){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(c){return function(a){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,c[0]&&(s=0)),s;)try{if(n=1,o&&(r=2&c[0]?o.return:c[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,c[1])).done)return r;switch(o=0,r&&(c=[2&c[0],r.value]),c[0]){case 0:case 1:r=c;break;case 4:return s.label++,{value:c[1],done:!1};case 5:s.label++,o=c[1],c=[0];continue;case 7:c=s.ops.pop(),s.trys.pop();continue;default:if(!(r=s.trys,(r=r.length>0&&r[r.length-1])||6!==c[0]&&2!==c[0])){s=0;continue}if(3===c[0]&&(!r||c[1]>r[0]&&c[1]<r[3])){s.label=c[1];break}if(6===c[0]&&s.label<r[1]){s.label=r[1],r=c;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(c);break}r[2]&&s.ops.pop(),s.trys.pop();continue}c=e.call(t,s)}catch(t){c=[6,t],o=0}finally{n=r=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,a])}}}function n(t,e){return function(){for(var n=[],o=0;o<arguments.length;o++)n[o]=arguments[o];return t.apply(e,n)}}"function"==typeof SuppressedError&&SuppressedError;var o,r=Array.isArray,i=(o="function",function(t){return typeof t===o});function s(t){return t&&"object"==typeof t&&!Array.isArray(t)}function c(t){for(var e,n,o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];if(!o.length)return t;var i=o.shift();if(s(t)&&s(i))for(var a in i)i.hasOwnProperty(a)&&(s(i[a])?(t[a]||Object.assign(t,((e={})[a]={},e)),c(t[a],i[a])):Object.assign(t,((n={})[a]=i[a],n)));return c.apply(void 0,function(t,e,n){if(n||2===arguments.length)for(var o,r=0,i=e.length;r<i;r++)!o&&r in e||(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}([t],o,!1))}var a,u=function(t,e,o,s){return function(t,e,n){var o,i,s=(void 0===n?{}:n).allOwnKeys,c=void 0!==s&&s;if(null!=t)if("object"!=typeof t&&(t=[t]),r(t))for(o=0,i=t.length;o<i;o++)e.call(null,t[o],o,t);else{var a=c?Object.getOwnPropertyNames(t):Object.keys(t),u=a.length,l=void 0;for(o=0;o<u;o++)l=a[o],e.call(null,t[l],l,t)}}(e,(function(e,r){o&&i(e)?t[r]=n(e,o):t[r]=e}),{allOwnKeys:(void 0===s?{allOwnKeys:!1}:s).allOwnKeys}),t},l=(a=Object.create(null),function(t){var e=toString.call(t);return a[e]||(a[e]=e.slice(8,-1).toLowerCase())}),f=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")};const p="undefined"!=typeof process&&"process"===l(process)&&function(){this.type="node",console.log("node",this,f)};let h;const d=new Uint8Array(16);function y(){if(!h&&(h="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!h))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return h(d)}const v=[];for(let t=0;t<256;++t)v.push((t+256).toString(16).slice(1));const b={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function g(t,e,n){if(b.randomUUID&&!e&&!t)return b.randomUUID();const o=(t=t||{}).random||(t.rng||y)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,e){n=n||0;for(let t=0;t<16;++t)e[n+t]=o[t];return e}return function(t,e=0){return v[t[e+0]]+v[t[e+1]]+v[t[e+2]]+v[t[e+3]]+"-"+v[t[e+4]]+v[t[e+5]]+"-"+v[t[e+6]]+v[t[e+7]]+"-"+v[t[e+8]]+v[t[e+9]]+"-"+v[t[e+10]]+v[t[e+11]]+v[t[e+12]]+v[t[e+13]]+v[t[e+14]]+v[t[e+15]]}(o)}var k;const m="undefined"!=typeof WebSocket&&(k=function(){function n(n,o){var r,i,s=this;this.type="client",this.socket=null,this.reconnectMaxCount=3,this.heartbeatTime=6e3,this.requestCallbacks={},this.heartbeatTimer=null,this.connect=function(){s.close(),s.socket=new WebSocket(s.url),s.onError(),s.onOpen(),s.onMessage()},this.login=function(){return t(s,void 0,void 0,(function(){return e(this,(function(t){return[2]}))}))},this.onMessage=function(){s.socket.onmessage=function(n){return t(s,void 0,void 0,(function(){var t,o,r,i,s,c,a;return e(this,(function(e){try{if(t=JSON.parse(null==n?void 0:n.data),o=t.type,r=t.body,i=r.request_id,s=r.status,c=r.origin_type,a=r.context,"copy"===o)return i&&this.requestCallbacks[i]&&(s||(console.error("".concat(c," : ").concat(a.message)),(a.message.includes("access_token")||a.message.includes("login yet"))&&console.log("refresh token")),"user_login"===c&&this.processMessageQueue(),this.requestCallbacks[i](t),delete this.requestCallbacks[i]),[2];this.socketCustomMessageEventList[o]&&this.socketCustomMessageEventList[o](t)}catch(t){console.error(t)}return[2]}))}))}},this.processMessageQueue=function(){},this.ignoreLoginMessage=function(t){return"user_login"===t.type||"ping"===t.type},this.reconnect=function(){return new Promise((function(t,e){s.connect(),t({})}))};var a=c(o,{autoReconnect:{reconnectMaxCount:3},heartbeat:{interval:1e4},query:{}});this.url=this.formatUrl(n,a.query),this.reconnectMaxCount=(null===(r=a.autoReconnect)||void 0===r?void 0:r.reconnectMaxCount)||3,this.heartbeatTime=(null===(i=a.heartbeat)||void 0===i?void 0:i.interval)||3e3,this.socketCustomMessageEventList=(null==a?void 0:a.onMessageEvent)||{},this.connect()}return n.prototype.onOpen=function(){var t=this;this.socket&&(this.socket.onopen=function(){t.login(),t.heartbeatTime&&t.startHeartbeat()})},n.prototype.startHeartbeat=function(){var t=this,e=this.heartbeatTime;this.heartbeatTimer=setInterval((function(){t.send({type:"heartbeat",request_id:g(),body:{}})}),e)},n.prototype.send=function(t,e){var n=this;return void 0===e&&(e=function(){}),new Promise((function(o,r){if(n.socket){var i=function(){if(n.socket)if(n.socket.readyState===n.socket.OPEN)try{n.requestCallbacks[t.request_id||g()]=function(t){e(t),o(t)},n.socket.send(JSON.stringify(t)),o()}catch(t){r(t)}else[n.socket.CLOSING,n.socket.CLOSED].includes(n.socket.readyState)?n.reconnect().then((function(){setTimeout(i,1e3)})).catch(r):n.socket.readyState===n.socket.CONNECTING&&setTimeout(i,1e3);else r(new Error("socket is null"))};i()}else r(new Error("socket is null"))}))},n.prototype.close=function(){var t;null===(t=this.socket)||void 0===t||t.close(),clearInterval(this.heartbeatTimer),this.socket=null},n.prototype.onError=function(){this.socket&&(this.socket.onerror=function(t){console.log("socket:error:event:",t)})},n.prototype.formatUrl=function(t,e){var n=t.includes("?");return t+=Object.keys(e).length?"".concat(n?"&":"?").concat(Object.keys(e).map((function(t){return"".concat(t,"=").concat(e[t])})).join("&")):""},n}(),k.isLoggedIn=!1,k.unloginMessageQueue=[],k);var w={webSocket:m,nodeSocket:p},O=function(t){return i(t)||null===t||!1===t},S=function(t){return"- ".concat(t)};const C=function(t){for(var e,n,o=r(t)?t:[t],i=t.length,s={},c=0;c<i;c++){var a=void 0;if(n=e=o[c],O(e)||void 0===(n=w[a=String(e)])&&console.error("Unknown adapter '".concat(a,"'")),n)break;s[a||"#"+c]=n}if(!n){var u=Object.entries(s).map((function(t){var e=t[0],n=t[1];return"adapter ".concat(e," ")+(!1===n?"is not supported by the environment":"is not available in the build")})),l=i?u.length>1?"since :\n"+u.map(S).join("\n"):" "+S(u[0]):"as no adapter specified";console.error("There is no suitable adapter to dispatch the request "+l,"ERR_NOT_SUPPORT")}return n};var E=function(){function t(t){this.defaults=t,this.config=t}return t.prototype.init=function(t){this.config=c(this.defaults,t);var e=new(C(t.adapter||this.defaults.adapter));console.log(e.type)},t}();var U,j,M=(U=new E({adapter:["webSocket","nodeSocket"],url:"https://api.moobius.net"}),j=n(E.prototype.init,U),u(j,E.prototype,U,{allOwnKeys:!0}),u(j,U,null,{allOwnKeys:!0}),j);export{M as default};
//# sourceMappingURL=moobius-api-sdk.min.js.map
